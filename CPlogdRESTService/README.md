# Swagger Jersey generated server

## Overview
This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the 
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server stub.  This
is an example of building a swagger-enabled JAX-RS server.

This example uses the [JAX-RS](https://jax-rs-spec.java.net/) framework.

To run the server, execute the following:

```
mvn clean package jetty:run
```

You can then view the swagger listing here:

```
http://localhost:8080/v1/swagger.json
```

Note that if you have configured the `host` to be something other than localhost, the calls through
swagger-ui will be directed to that host and not localhost!

## Environment variable

Please pass the environment variable `HOST_URL` that will be used to build the complete path for each endpoint and 
is pieced together as: "http://[HOST_URL]/[base_path]/endpoint" where [base_path] is set in the swagger and web.xml
to `/v1`


## Dockerfile

Dockerfile is located in directory "Docker"
The Dockerfile should start with the base jetty-image, Swagger used
jetty version 9.2 so we should do that as well. We also use Java7 so 
the jre7 is the required java-version of the image. 
We simply need to add our WAR-file to the jetty root and expose the 
service port 8080. 

### Dockerfile
``` 
FROM jetty:9.2-jre7
ADD *.war /var/lib/jetty/webapps/root.war
COPY dist/ /var/lib/jetty/webapps/api
EXPOSE 8080
``` 

### Using docker to create image and run

First you need to add the `.war`-file to the Docker-folder, as we do not want
to have to mount any extra directories to the Docker-image.
If you're standing in your Docker-folder run the following command to get
a docker-image with the name cplogd:
``` 
docker build -t cplogd .
```

use the default web-port (80) and forward to the port jetty listens to (8080):
```
docker run -it -p 80:8080 cplogd
```
(the `-it` makes print information, remove when in production-mode)

### Automation

Simply run: 
```
build.sh
```
to use maven to build the WAR, copy it and the Dist-folder (serving Swagger UI) into the Docker directory 
and use docker to build and compress the docker image. 

#### Try it out
If everything is working properly, jetty will be listening on the default web port (80), it should serve the Swagger UI on:
```
localhost/api
```

Swagger should be accessible at:
```
localhost/v1/swagger.json
localhost/v1/swagger.yaml
```

Running predictions at:
```
localhost/v1/prediction?smiles=CC(%3DO)OCC%5BN%2B%5D(C)(C)C&confidence=0.8
```


## Add CPSign-jar to maven local repo

https://devcenter.heroku.com/articles/local-maven-dependencies

cd into the lib directory, run command:
mvn deploy:deploy-file -Durl=file:///Users/staffan/git/cplogd/CPlogdRESTService/repository/ -Dfile=cpsign-0.6.7.jar -DgroupId=com.genettasoft -DartifactId=cpsign -Dpackaging=jar -Dversion=0.6.7
