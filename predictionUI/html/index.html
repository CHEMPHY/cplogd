<html>

<head>
<script type="text/javascript" language="javascript" src="jsme/jsme.nocache.js"></script>

<script>
 //this function will be called after the JavaScriptApplet code has been loaded.
    function jsmeOnLoad() {
        jsmeApplet = new JSApplet.JSME("jsme_container", "100%", "44%");
        jsmeApplet.setAfterStructureModifiedCallback(showEvent);
   	    var image = document.getElementById('image');
		//image.src = "https://cplogd.service.pharmb.io/v1/predictionImage?smiles=&imageWidth="+ Math.floor(window.innerWidth*0.9) +"&imageHeight=" + window.innerHeight/2 
    }

    function imageNotFound() {
        document.getElementById('error_label').innerText = "ERROR: Something went wrong with rendering the prediction image. Please try with another molecule or contact a site administrator if the problem persists."
    }

    function imageFound() {
        document.getElementById('error_label').innerText = ""
    }

    function showEvent(event) {
        redraw()
    }

    function redraw() {
        var smiles = jsmeApplet.smiles()
        var confidence = document.getElementById('confidence').value
        window.setTimeout( function() { doRedraw(smiles, confidence) }, 100 );
    }

    function doRedraw(smiles, confidence) {
        if ( smiles != jsmeApplet.smiles() || confidence != document.getElementById('confidence').value) {
            return;
        }
        var imageurl = "https://cplogd.service.pharmb.io/v1/predictionImage?smiles=" + jsmeApplet.smiles() 
                     + "&imageWidth="  + Math.floor(window.innerWidth*0.9) 
                     + "&imageHeight=" + Math.floor(window.innerHeight*0.40-45-75)
                     + "&addTitle=true" 
                     + "&confidence=" + document.getElementById('confidence').value
        var tester = new Image();
        tester.addEventListener('error', imageNotFound)
        tester.addEventListener('load', imageFound)
        tester.src = imageurl;
	    var image = document.getElementById('image');
		image.src = imageurl;
    }

</script>
</head>

<body>
<div style="width: 100%; height: 74px; border-bottom: 1px solid #ccc;">
    <div style="width: 960px; margin: 0 auto;">
        <div style="width: 400px; float: left;">
            <h1 style="margin: .24em 0; font-family: Ubuntu, arial, helvetica, sans-serif; letter-spacing: -1px; color: #aaa;"><img src="pharmbio_logo.png" style="position: relative; top: 6px; height: 36px; margin-right: .2em;">pharm<span style="color: #c00"><span>b.io</span></span></h1>
        </div>
        <div style="width: 64px; float: right;">
            <img src="uu_logo.png">
        </div>
    </div>
</div>

	<noscript>
		<div
			style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
			Your web browser must have JavaScript enabled in order for this
			application to display correctly.</div>
	</noscript>
    <div id="jsme_container"></div>
    Confidence:
<input id="slider1" type="range" min="0" max="1" step="0.01" value="0.95" 
       onchange="document.getElementById('confidence').value = document.getElementById('slider1').value; redraw()">
<input id="confidence" type="text" size="4" value="0.95" disabled>  

    <div id="error_label" style="color:red"></div>
    <img id="image" style="display: block; margin: auto;"></img>
</body>
</html>
